---
import BaseLayout from "../layouts/BaseLayout.astro";

const title = "Cidades — Nova Raiz";
const description = "Diretório de cidades para viver no interior: busque, filtre por região e encontre guias e comparativas.";
const cities = [
  // Sudeste
  { name: "Vinhedo", uf: "SP", region: "Sudeste", slug: "/cidades/vinhedo", tags: ["Guia completo"], hasGuide: true, hasComparatives: true },
  { name: "Campinas", uf: "SP", region: "Sudeste", slug: "/blog/morar-em-campinas-sp-2026", tags: ["Guia no blog"], hasGuide: false, hasComparatives: true },
  { name: "Jundiaí", uf: "SP", region: "Sudeste", slug: "/blog/custo-de-vida-em-jundiai-2026", tags: ["Custo de vida"], hasGuide: false, hasComparatives: true },
  { name: "Indaiatuba", uf: "SP", region: "Sudeste", slug: "/blog/campinas-vs-indaiatuba-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Poços de Caldas", uf: "MG", region: "Sudeste", slug: "/cidades/pocos-de-caldas", tags: ["Guia completo"], hasGuide: true, hasComparatives: true },
  { name: "Uberaba", uf: "MG", region: "Sudeste", slug: "/blog/morar-em-uberaba-mg-2026", tags: ["Guia no blog"], hasGuide: false, hasComparatives: false },
  { name: "Petrópolis", uf: "RJ", region: "Sudeste", slug: "/blog/morar-em-petropolis-rj-2026", tags: ["Guia no blog"], hasGuide: false, hasComparatives: true },

  // Sul
  { name: "Gramado", uf: "RS", region: "Sul", slug: "/cidades/gramado", tags: ["Guia completo"], hasGuide: true, hasComparatives: true },
  { name: "Bento Gonçalves", uf: "RS", region: "Sul", slug: "/blog/morar-em-bento-goncalves-rs-2026", tags: ["Guia no blog"], hasGuide: false, hasComparatives: true },
  { name: "Joinville", uf: "SC", region: "Sul", slug: "/blog/joinville-vs-florianopolis-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Blumenau", uf: "SC", region: "Sul", slug: "/blog/blumenau-vs-joinville-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Curitiba", uf: "PR", region: "Sul", slug: "/blog/maringa-vs-curitiba-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Maringá", uf: "PR", region: "Sul", slug: "/blog/maringa-vs-curitiba-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },

  // Centro-Oeste
  { name: "Brasília", uf: "DF", region: "Centro-Oeste", slug: "/blog/brasilia-vs-taguatinga-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Goiânia", uf: "GO", region: "Centro-Oeste", slug: "/blog/goiania-vs-aparecida-de-goiania-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Campo Grande", uf: "MS", region: "Centro-Oeste", slug: "/blog/campo-grande-vs-goiania-2026", tags: ["Em breve"], hasGuide: false, hasComparatives: false },

  // Nordeste
  { name: "João Pessoa", uf: "PB", region: "Nordeste", slug: "/blog/joao-pessoa-vs-campina-grande-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Natal", uf: "RN", region: "Nordeste", slug: "/blog/natal-vs-parnamirim-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Recife", uf: "PE", region: "Nordeste", slug: "/blog/recife-vs-olinda-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Salvador", uf: "BA", region: "Nordeste", slug: "/blog/salvador-vs-feira-de-santana-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Fortaleza", uf: "CE", region: "Nordeste", slug: "/blog/fortaleza-vs-caucaia-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Maceió", uf: "AL", region: "Nordeste", slug: "/blog/maceio-vs-arapiraca-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },

  // Norte
  { name: "Manaus", uf: "AM", region: "Norte", slug: "/blog/manaus-vs-belem-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
  { name: "Belém", uf: "PA", region: "Norte", slug: "/blog/manaus-vs-belem-2026", tags: ["Comparativa"], hasGuide: false, hasComparatives: true },
];
const regions = ["Todas", "Sudeste", "Sul", "Centro-Oeste", "Nordeste", "Norte"];
const ufs = ["Todas", ...Array.from(new Set(cities.map(c => c.uf))).sort()];
---

<BaseLayout title={title} description={description}>
  <section class="py-10 md:py-14">
    <div class="flex flex-col gap-3">
      <h1 class="text-4xl md:text-5xl" style="font-family:'Playfair Display', serif;">Cidades</h1>
      <p class="text-lg" style="color: var(--muted);">
        Busque por cidade, filtre por região/UF e encontre guias e comparativas já publicadas.
      </p>
    </div>

    <div class="mt-8 grid gap-4 md:grid-cols-3">
      <div class="rounded-3xl border p-4 md:col-span-2" style="border-color: var(--border); background: var(--card);">
        <label class="text-sm font-semibold" style="color: var(--muted);" for="citySearch">Buscar</label>
        <input
          id="citySearch"
          type="search"
          placeholder="Ex: Vinhedo, Gramado, Poços..."
          class="mt-2 w-full rounded-2xl border px-4 py-3 text-base"
          style="border-color: var(--border); background: var(--surface);"
        />
        <div class="mt-3 text-xs" style="color: var(--muted);">
          Dica: digite só parte do nome (ex: “joa” para João Pessoa).
        </div>
      </div>

      <div class="rounded-3xl border p-4" style="border-color: var(--border); background: var(--card);">
        <div class="text-sm font-semibold" style="color: var(--muted);">Filtros</div>

        <div class="mt-3">
          <label class="text-xs font-semibold" style="color: var(--muted);" for="regionFilter">Região</label>
          <select id="regionFilter" class="mt-2 w-full rounded-2xl border px-3 py-2"
            style="border-color: var(--border); background: var(--surface);">
            {regions.map(r => <option value={r}>{r}</option>)}
          </select>
        </div>

        <div class="mt-3">
          <label class="text-xs font-semibold" style="color: var(--muted);" for="ufFilter">UF</label>
          <select id="ufFilter" class="mt-2 w-full rounded-2xl border px-3 py-2"
            style="border-color: var(--border); background: var(--surface);">
            {ufs.map(u => <option value={u}>{u}</option>)}
          </select>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          <button id="toggleGuide" class="rounded-full border px-3 py-1 text-xs"
            style="border-color: var(--border); background: var(--surface);">
            Só com guia completo
          </button>
          <button id="toggleComparatives" class="rounded-full border px-3 py-1 text-xs"
            style="border-color: var(--border); background: var(--surface);">
            Só com comparativas
          </button>
          <button id="clearFilters" class="rounded-full border px-3 py-1 text-xs"
            style="border-color: var(--border); background: var(--surface);">
            Limpar
          </button>
        </div>
      </div>
    </div>

    <div class="mt-8 flex items-center justify-between gap-3">
      <div class="text-sm" style="color: var(--muted);">
        <span id="resultsCount"></span>
      </div>
      <div class="text-sm">
        <a class="underline" href="/ranking-melhores-cidades-2026">Ver Ranking 2026</a>
      </div>
    </div>

    <div id="citiesGrid" class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {cities.map((c) => (
        <a
          class="city-card group rounded-3xl border p-5 transition hover:-translate-y-0.5"
          style="border-color: var(--border); background: var(--card);"
          href={c.slug}
          data-name={c.name.toLowerCase()}
          data-uf={c.uf}
          data-region={c.region}
          data-guide={c.hasGuide ? "1" : "0"}
          data-comp={c.hasComparatives ? "1" : "0"}
        >
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-xl font-semibold">{c.name}</div>
              <div class="mt-1 text-sm" style="color: var(--muted);">{c.uf} • {c.region}</div>
            </div>
            {c.hasGuide ? (
              <span class="rounded-full border px-2 py-1 text-[11px]"
                style="border-color: var(--border); background: var(--surface);">
                Guia completo
              </span>
            ) : (
              <span class="rounded-full border px-2 py-1 text-[11px]"
                style="border-color: var(--border); background: var(--surface);">
                Artigo/Comparativa
              </span>
            )}
          </div>

          <div class="mt-4 flex flex-wrap gap-2">
            {c.tags.slice(0, 3).map((t) => (
              <span class="rounded-full border px-2 py-1 text-[11px]"
                style="border-color: var(--border); background: var(--surface); color: var(--muted);">
                {t}
              </span>
            ))}
            {c.hasComparatives ? (
              <span class="rounded-full border px-2 py-1 text-[11px]"
                style="border-color: var(--border); background: var(--surface); color: var(--muted);">
                Tem comparativas
              </span>
            ) : null}
          </div>

          <div class="mt-4 text-sm underline" style="color: var(--muted);">
            Abrir →
          </div>
        </a>
      ))}
    </div>

    <div id="noResults" class="mt-10 hidden rounded-3xl border p-6 text-center"
      style="border-color: var(--border); background: var(--card); color: var(--muted);">
      Nenhum resultado com esses filtros. Tente limpar ou buscar por outro termo.
    </div>

    <script is:inline>
      (() => {
        const search = document.getElementById("citySearch");
        const region = document.getElementById("regionFilter");
        const uf = document.getElementById("ufFilter");
        const toggleGuide = document.getElementById("toggleGuide");
        const toggleComp = document.getElementById("toggleComparatives");
        const clear = document.getElementById("clearFilters");
        const cards = Array.from(document.querySelectorAll(".city-card"));
        const count = document.getElementById("resultsCount");
        const noResults = document.getElementById("noResults");

        let onlyGuide = false;
        let onlyComp = false;

        const setActive = (btn, active) => {
          btn.style.background = active ? "var(--surface)" : "var(--card)";
          btn.style.fontWeight = active ? "700" : "400";
        };

        const apply = () => {
          const q = (search.value || "").trim().toLowerCase();
          const r = region.value;
          const u = uf.value;

          let visible = 0;

          for (const card of cards) {
            const name = card.dataset.name || "";
            const cardRegion = card.dataset.region || "";
            const cardUf = card.dataset.uf || "";
            const hasGuide = card.dataset.guide === "1";
            const hasComp = card.dataset.comp === "1";

            const okQ = !q || name.includes(q);
            const okR = (r === "Todas") || (cardRegion === r);
            const okU = (u === "Todas") || (cardUf === u);
            const okG = !onlyGuide || hasGuide;
            const okC = !onlyComp || hasComp;

            const ok = okQ && okR && okU && okG && okC;
            card.style.display = ok ? "" : "none";
            if (ok) visible++;
          }

          count.textContent = visible + " cidade(s) encontradas";
          noResults.classList.toggle("hidden", visible !== 0);
        };

        toggleGuide.addEventListener("click", () => {
          onlyGuide = !onlyGuide;
          setActive(toggleGuide, onlyGuide);
          apply();
        });

        toggleComp.addEventListener("click", () => {
          onlyComp = !onlyComp;
          setActive(toggleComp, onlyComp);
          apply();
        });

        clear.addEventListener("click", () => {
          search.value = "";
          region.value = "Todas";
          uf.value = "Todas";
          onlyGuide = false;
          onlyComp = false;
          setActive(toggleGuide, false);
          setActive(toggleComp, false);
          apply();
        });

        search.addEventListener("input", apply);
        region.addEventListener("change", apply);
        uf.addEventListener("change", apply);

        // init
        setActive(toggleGuide, false);
        setActive(toggleComp, false);
        apply();
      })();
    </script>
  </section>
</BaseLayout>
