---
import Layout from "../layouts/Layout.astro";

const title = "Cidades ‚Äî Nova Raiz";
const description = "Diret√≥rio de cidades com busca e filtros por regi√£o/estado. Encontre guias completos e artigos para planejar sua mudan√ßa para o interior.";
---

<Layout title={title} description={description}>
  <!-- Breadcrumbs (SEO) -->
  <script type="application/ld+json" is:inline>
    {JSON.stringify({
      "@context":"https://schema.org",
      "@type":"BreadcrumbList",
      "itemListElement":[
        {"@type":"ListItem","position":1,"name":"In√≠cio","item":"https://novaraiz.netlify.app/"},
        {"@type":"ListItem","position":2,"name":"Cidades","item":"https://novaraiz.netlify.app/cidades/"}
      ]
    })}
  </script>

  <section class="max-w-6xl mx-auto px-4 py-10 md:py-14 space-y-8">
    <header class="space-y-3">
      <h1 class="text-4xl md:text-5xl font-bold" style="font-family:'Playfair Display', serif;">Cidades</h1>
      <p class="text-lg" style="color: var(--muted);">
        Use a busca e os filtros para encontrar <strong>guias completos</strong>, <strong>comparativas</strong> e artigos por cidade.
      </p>
    </header>

    <div class="grid gap-4 md:grid-cols-12">
      <!-- Search -->
      <div class="md:col-span-6 rounded-3xl border p-5" style="border-color: var(--border); background: var(--card);">
        <label for="citySearch" class="text-sm font-semibold" style="color: var(--muted);">Buscar cidade</label>
        <input
          id="citySearch"
          type="search"
          placeholder="Ex: Vinhedo, Gramado, Campinas..."
          class="mt-2 w-full rounded-2xl border px-4 py-3 text-base outline-none"
          style="border-color: var(--border); background: var(--surface);"
        />
        <p class="mt-2 text-xs" style="color: var(--muted);">
          Dica: voc√™ pode buscar por <em>cidade</em>, <em>UF</em> ou <em>regi√£o</em>.
        </p>
      </div>

      <!-- Filters -->
      <div class="md:col-span-6 rounded-3xl border p-5" style="border-color: var(--border); background: var(--card);">
        <div class="text-sm font-semibold" style="color: var(--muted);">Filtros</div>

        <div class="mt-3 grid gap-3 sm:grid-cols-2">
          <div>
            <label class="text-xs font-semibold" style="color: var(--muted);" for="regionFilter">Regi√£o</label>
            <select id="regionFilter" class="mt-1 w-full rounded-2xl border px-3 py-3 text-sm"
              style="border-color: var(--border); background: var(--surface);">
              <option value="all">Todas</option>
              <option value="Sudeste">Sudeste</option>
              <option value="Sul">Sul</option>
              <option value="Centro-Oeste">Centro-Oeste</option>
              <option value="Nordeste">Nordeste</option>
              <option value="Norte">Norte</option>
            </select>
          </div>

          <div>
            <label class="text-xs font-semibold" style="color: var(--muted);" for="ufFilter">Estado (UF)</label>
            <select id="ufFilter" class="mt-1 w-full rounded-2xl border px-3 py-3 text-sm"
              style="border-color: var(--border); background: var(--surface);">
              <option value="all">Todos</option>
              <option value="SP">SP</option><option value="RJ">RJ</option><option value="MG">MG</option><option value="ES">ES</option>
              <option value="PR">PR</option><option value="SC">SC</option><option value="RS">RS</option>
              <option value="DF">DF</option><option value="GO">GO</option><option value="MT">MT</option><option value="MS">MS</option>
              <option value="BA">BA</option><option value="CE">CE</option><option value="PE">PE</option><option value="PB">PB</option>
              <option value="RN">RN</option><option value="AL">AL</option><option value="SE">SE</option><option value="MA">MA</option><option value="PI">PI</option>
              <option value="PA">PA</option><option value="AM">AM</option>
            </select>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          <button id="tagAll" class="rounded-full border px-4 py-2 text-sm font-semibold"
            style="border-color: var(--border); background: var(--surface);">
            Todos
          </button>
          <button id="tagPillar" class="rounded-full border px-4 py-2 text-sm font-semibold"
            style="border-color: var(--border); background: var(--surface);">
            ‚úÖ Guia completo
          </button>
          <button id="tagComparativas" class="rounded-full border px-4 py-2 text-sm font-semibold"
            style="border-color: var(--border); background: var(--surface);">
            üìä Tem comparativas
          </button>
        </div>

        <div class="mt-3 text-xs" style="color: var(--muted);">
          O diret√≥rio vai crescendo com o site ‚Äî conforme voc√™ publicar novos guias, √© s√≥ adicionar a cidade na lista.
        </div>
      </div>
    </div>

    <div class="flex items-center justify-between">
      <div class="text-sm" style="color: var(--muted);">
        <span id="resultsCount">0</span> cidades exibidas
      </div>
      <a class="text-sm underline" href="/ranking-melhores-cidades-2026" style="color: var(--muted);">
        Ver Ranking 2026 ‚Üí
      </a>
    </div>

    <!-- Cards -->
    <div id="citiesGrid" class="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
      {[
        // Pilares (guia completo)
        { name: "Vinhedo", uf: "SP", region: "Sudeste", pillarUrl: "/cidades/vinhedo", blogUrl: "/blog", comparativas: true, tags: ["pillar","comparativas"] },
        { name: "Gramado", uf: "RS", region: "Sul", pillarUrl: "/cidades/gramado", blogUrl: "/blog", comparativas: true, tags: ["pillar","comparativas"] },
        { name: "Po√ßos de Caldas", uf: "MG", region: "Sudeste", pillarUrl: "/cidades/pocos-de-caldas", blogUrl: "/blog", comparativas: true, tags: ["pillar","comparativas"] },

        // Estrat√©gicas (j√° com artigos/guia no blog ou cluster)
        { name: "Campinas", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-campinas-sp-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Jundia√≠", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/custo-de-vida-em-jundiai-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Sorocaba", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-sorocaba-sp-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Indaiatuba", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/indaiatuba-e-segura-guia-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "S√£o Jos√© dos Campos", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-sao-jose-dos-campos-sp-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Ribeir√£o Preto", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/ribeirao-preto-home-office-vale-a-pena/", comparativas: true, tags: ["comparativas"] },
        { name: "S√£o Carlos", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-sao-carlos-sp-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Atibaia", uf: "SP", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-atibaia-sp-2026/", comparativas: false, tags: [] },

        { name: "Petr√≥polis", uf: "RJ", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-petropolis-rj-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Teres√≥polis", uf: "RJ", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-teresopolis-rj-2026/", comparativas: true, tags: ["comparativas"] },

        { name: "Uberaba", uf: "MG", region: "Sudeste", pillarUrl: "", blogUrl: "/blog/morar-em-uberaba-mg-2026/", comparativas: false, tags: [] },

        // Sul
        { name: "Crici√∫ma", uf: "SC", region: "Sul", pillarUrl: "", blogUrl: "/blog/morar-em-criciuma-sc-2026/", comparativas: false, tags: [] },
        { name: "Jaragu√° do Sul", uf: "SC", region: "Sul", pillarUrl: "", blogUrl: "/blog/morar-em-jaragua-do-sul-sc-2026/", comparativas: false, tags: [] },
        { name: "Ponta Grossa", uf: "PR", region: "Sul", pillarUrl: "", blogUrl: "/blog/morar-em-ponta-grossa-pr-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Guarapuava", uf: "PR", region: "Sul", pillarUrl: "", blogUrl: "/blog/morar-em-guarapuava-pr-2026/", comparativas: false, tags: [] },
        { name: "Foz do Igua√ßu", uf: "PR", region: "Sul", pillarUrl: "", blogUrl: "/blog/morar-em-foz-do-iguacu-pr-2026/", comparativas: false, tags: [] },
        { name: "Bento Gon√ßalves", uf: "RS", region: "Sul", pillarUrl: "", blogUrl: "/blog/morar-em-bento-goncalves-rs-2026/", comparativas: true, tags: ["comparativas"] },
        { name: "Santa Maria", uf: "RS", region: "Sul", pillarUrl: "", blogUrl: "/blog/morar-em-santa-maria-rs-2026/", comparativas: false, tags: [] },

        // Nordeste (comparativas no blog / expans√£o)
        { name: "Salvador", uf: "BA", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Fortaleza", uf: "CE", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Recife", uf: "PE", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Jo√£o Pessoa", uf: "PB", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Natal", uf: "RN", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Macei√≥", uf: "AL", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Aracaju", uf: "SE", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "S√£o Lu√≠s", uf: "MA", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Teresina", uf: "PI", region: "Nordeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },

        // Centro-Oeste
        { name: "Bras√≠lia", uf: "DF", region: "Centro-Oeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Goi√¢nia", uf: "GO", region: "Centro-Oeste", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },

        // Norte
        { name: "Bel√©m", uf: "PA", region: "Norte", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
        { name: "Manaus", uf: "AM", region: "Norte", pillarUrl: "", blogUrl: "/blog", comparativas: true, tags: ["comparativas"] },
      ].map((c) => (
        <article
          class="city-card rounded-3xl border p-6 hover:shadow-sm transition"
          style="border-color: var(--border); background: var(--card);"
          data-name={c.name}
          data-uf={c.uf}
          data-region={c.region}
          data-tags={c.tags.join(",")}
        >
          <div class="flex items-start justify-between gap-4">
            <div>
              <h2 class="text-xl font-semibold">{c.name} <span class="text-sm font-semibold" style="color: var(--muted);">({c.uf})</span></h2>
              <div class="mt-1 text-sm" style="color: var(--muted);">{c.region}</div>
            </div>

            <div class="flex flex-col items-end gap-2">
              {c.tags.includes("pillar") ? (
                <span class="rounded-full px-3 py-1 text-xs font-semibold" style="background: rgba(244,196,48,.14); color: var(--text); border: 1px solid var(--border);">
                  ‚úÖ Guia completo
                </span>
              ) : (
                <span class="rounded-full px-3 py-1 text-xs font-semibold" style="background: rgba(44,44,46,.06); color: var(--muted); border: 1px solid var(--border);">
                  Artigos & contexto
                </span>
              )}

              {c.comparativas ? (
                <span class="rounded-full px-3 py-1 text-xs font-semibold" style="background: rgba(44,44,46,.06); color: var(--muted); border: 1px solid var(--border);">
                  üìä Tem comparativas
                </span>
              ) : null}
            </div>
          </div>

          <div class="mt-5 flex flex-wrap gap-2">
            {c.pillarUrl ? (
              <a class="rounded-full px-4 py-2 text-sm font-semibold"
                 href={c.pillarUrl}
                 style="background: var(--primary); color: white;">
                Ver guia
              </a>
            ) : (
              <a class="rounded-full border px-4 py-2 text-sm font-semibold"
                 href={c.blogUrl}
                 style="border-color: var(--border); background: var(--surface);">
                Ver artigos
              </a>
            )}

            <a class="rounded-full border px-4 py-2 text-sm font-semibold"
               href={"/blog"}
               style="border-color: var(--border); background: var(--surface);">
              Buscar no blog
            </a>
          </div>

          <div class="mt-4 text-xs" style="color: var(--muted);">
            Dica r√°pida: para planejamento de mudan√ßa, comece pelo <a class="underline" href="/mudar-para-o-interior-guia-definitivo/">Guia Definitivo</a> e pelo <a class="underline" href="/checklist/">Checklist</a>.
          </div>
        </article>
      ))}
    </div>

    <div id="noResults" class="hidden rounded-3xl border p-8 text-center"
      style="border-color: var(--border); background: var(--card);">
      <div class="text-lg font-semibold">Nenhuma cidade encontrada</div>
      <div class="mt-2 text-sm" style="color: var(--muted);">
        Tente buscar por outro termo (ex: ‚ÄúSP‚Äù, ‚ÄúSul‚Äù, ‚ÄúCampinas‚Äù) ou limpe os filtros.
      </div>
      <div class="mt-5">
        <button id="clearAll" class="rounded-full px-5 py-2 text-sm font-semibold"
          style="background: var(--primary); color: white;">
          Limpar filtros
        </button>
      </div>
    </div>

    <footer class="rounded-3xl border p-6" style="border-color: var(--border); background: var(--surface);">
      <div class="text-sm font-semibold">Sugest√£o de navega√ß√£o</div>
      <div class="mt-3 grid gap-3 md:grid-cols-3 text-sm" style="color: var(--muted);">
        <a class="underline" href="/ranking-melhores-cidades-2026">Ranking Nacional 2026</a>
        <a class="underline" href="/mudar-para-o-interior-guia-definitivo/">Guia Definitivo da Mudan√ßa</a>
        <a class="underline" href="/checklist/">Checklist da Transi√ß√£o</a>
      </div>
    </footer>
  </section>

  <script is:inline>
    const $ = (id) => document.getElementById(id);

    const search = $("citySearch");
    const region = $("regionFilter");
    const uf = $("ufFilter");
    const noResults = $("noResults");
    const count = $("resultsCount");

    const tagAll = $("tagAll");
    const tagPillar = $("tagPillar");
    const tagComparativas = $("tagComparativas");
    const clearAll = $("clearAll");

    let activeTag = "all";

    function setActiveTag(tag) {
      activeTag = tag;
      [tagAll, tagPillar, tagComparativas].forEach(btn => btn.style.opacity = "0.75");
      if (tag === "all") tagAll.style.opacity = "1";
      if (tag === "pillar") tagPillar.style.opacity = "1";
      if (tag === "comparativas") tagComparativas.style.opacity = "1";
      applyFilters();
    }

    function normalize(str) {
      return (str || "").toString().toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "");
    }

    function applyFilters() {
      const q = normalize(search?.value?.trim() || "");
      const reg = region?.value || "all";
      const st = uf?.value || "all";

      const cards = Array.from(document.querySelectorAll(".city-card"));
      let visible = 0;

      cards.forEach(card => {
        const name = normalize(card.getAttribute("data-name"));
        const cardUf = card.getAttribute("data-uf") || "";
        const cardReg = card.getAttribute("data-region") || "";
        const tags = (card.getAttribute("data-tags") || "").split(",").filter(Boolean);

        const matchText = !q || name.includes(q) || normalize(cardUf).includes(q) || normalize(cardReg).includes(q);
        const matchRegion = reg === "all" || cardReg === reg;
        const matchUf = st === "all" || cardUf === st;
        const matchTag = activeTag === "all" || tags.includes(activeTag);

        const show = matchText && matchRegion && matchUf && matchTag;
        card.style.display = show ? "" : "none";
        if (show) visible += 1;
      });

      if (count) count.textContent = String(visible);
      if (noResults) noResults.classList.toggle("hidden", visible !== 0);
    }

    search?.addEventListener("input", applyFilters);
    region?.addEventListener("change", applyFilters);
    uf?.addEventListener("change", applyFilters);

    tagAll?.addEventListener("click", () => setActiveTag("all"));
    tagPillar?.addEventListener("click", () => setActiveTag("pillar"));
    tagComparativas?.addEventListener("click", () => setActiveTag("comparativas"));

    clearAll?.addEventListener("click", () => {
      if (search) search.value = "";
      if (region) region.value = "all";
      if (uf) uf.value = "all";
      setActiveTag("all");
      applyFilters();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    setActiveTag("all");
    applyFilters();
  </script>
</Layout>
