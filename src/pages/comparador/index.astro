---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { COMPARATIVAS } from "../../data/comparativas";

const title = "Comparador de cidades — Nova Raiz";
const description = "Escolha duas cidades do Brasil e abra a comparativa definitiva automaticamente.";

const cities = Array.from(
  new Map(
    COMPARATIVAS.flatMap((c) => [c.a, c.b]).map((x) => [`${x.name} (${x.uf})`, { name: x.name, uf: x.uf }])
  ).entries()
).map(([label, value]) => ({ label, value }))
 .sort((a,b)=>a.label.localeCompare(b.label,'pt-BR'));

const pairs = COMPARATIVAS.map((c) => ({
  slug: c.slug,
  a: `${c.a.name} (${c.a.uf})`,
  b: `${c.b.name} (${c.b.uf})`,
}));
---

<BaseLayout title={title} description={description}>
  <section class="py-10 md:py-14">
    <div class="mx-auto max-w-4xl">
      <nav class="text-xs" style="color: var(--muted);">
        <a class="underline" href="/">Home</a>
        <span class="mx-2">/</span>
        <a class="underline" href="/ferramentas/">Ferramentas</a>
        <span class="mx-2">/</span>
        <span>Comparador</span>
      </nav>

      <h1 class="mt-4 text-4xl md:text-5xl" style="font-family:'Playfair Display', serif;">Comparador (A vs B)</h1>
      <p class="mt-4 text-lg" style="color: var(--muted);">
        Selecione duas cidades e o Nova Raiz abre o comparativo definitivo. Simples, rápido e sem achismo.
      </p>

      <div class="mt-8 rounded-3xl border p-6" style="border-color: var(--border); background: var(--card);">
        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="text-sm font-semibold">Cidade A</label>
            <select id="cityA" class="mt-2 w-full rounded-xl border p-3" style="border-color: var(--border); background: var(--surface);">
              <option value="">Selecione...</option>
              {cities.map((c) => <option value={c.label}>{c.label}</option>)}
            </select>
          </div>
          <div>
            <label class="text-sm font-semibold">Cidade B</label>
            <select id="cityB" class="mt-2 w-full rounded-xl border p-3" style="border-color: var(--border); background: var(--surface);">
              <option value="">Selecione...</option>
              {cities.map((c) => <option value={c.label}>{c.label}</option>)}
            </select>
          </div>
        </div>

        <div class="mt-5 flex flex-wrap gap-3">
          <button id="goBtn" class="rounded-2xl px-5 py-3 text-sm font-semibold" style="background: var(--primary); color: white;">
            Abrir comparativa
          </button>
          <a class="rounded-2xl px-5 py-3 text-sm font-semibold border" style="border-color: var(--border);" href="/comparativas/">
            Ver todas as comparativas
          </a>
        </div>

        <div id="msg" class="mt-4 text-sm" style="color: var(--muted);"></div>
      </div>

      <div class="mt-8 rounded-3xl border p-6" style="border-color: var(--border); background: var(--surface);">
        <div class="text-sm font-semibold">Dica de uso</div>
        <p class="mt-2 text-sm" style="color: var(--muted);">
          Compare cidades da mesma região primeiro, depois abra uma comparativa “escala vs rotina” (cidade grande vs cidade média).
          Finalize com o checklist e visita-teste.
        </p>
        <div class="mt-4 text-sm">
          <a class="underline" href="/checklist/">Abrir checklist</a>
          <span class="mx-2" style="color: var(--muted);">•</span>
          <a class="underline" href="/mudar-para-o-interior-guia-definitivo/">Guia definitivo</a>
        </div>
      </div>
    </div>
  </section>

  <script define:vars={{ pairs }}>
    const $ = (id) => document.getElementById(id);
    const cityA = $("cityA");
    const cityB = $("cityB");
    const msg = $("msg");
    const goBtn = $("goBtn");

    const findSlug = (a, b) => {
      const direct = pairs.find(p => p.a === a && p.b === b);
      if (direct) return direct.slug;
      const reverse = pairs.find(p => p.a === b && p.b === a);
      if (reverse) return reverse.slug;
      return null;
    };

    goBtn.addEventListener("click", () => {
      const a = cityA.value;
      const b = cityB.value;

      if (!a || !b) {
        msg.textContent = "Selecione as duas cidades.";
        return;
      }
      if (a === b) {
        msg.textContent = "Escolha duas cidades diferentes.";
        return;
      }

      const slug = findSlug(a, b);
      if (!slug) {
        msg.innerHTML = `Ainda não temos essa comparativa pronta. Abra o cluster e escolha uma existente em <a class="underline" href="/comparativas/">/comparativas/</a>.`;
        return;
      }

      window.location.href = `/comparativas/${slug}/`;
    });
  </script>
</BaseLayout>
