---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { CITY_METRICS_2026, DEFAULT_WEIGHTS, scoreCity, STATE_NAMES } from "../../../data/rankingData";

export function getStaticPaths() {
  const states = Array.from(new Set(CITY_METRICS_2026.map((c) => c.state)));
  return states.map((uf) => ({ params: { uf: uf.toLowerCase() } }));
}

const { uf } = Astro.params;
const UF = (uf || "").toUpperCase();

const title = `Melhores cidades em ${STATE_NAMES[UF] ?? UF} (2026) — Nova Raiz`;
const description = `Ranking estadual (2026) em ${STATE_NAMES[UF] ?? UF}: pontuação por segurança, custo, internet, trabalho, saúde e educação.`;

const rows = CITY_METRICS_2026
  .filter((c) => c.state === UF)
  .map((m) => ({ ...m, score: scoreCity(m, DEFAULT_WEIGHTS).score }))
  .sort((a, b) => b.score - a.score);
---

<BaseLayout title={title} description={description}>
  <section class="container mx-auto px-4 py-10">
    <div class="max-w-4xl">
      <a href="/ranking/estados/" class="text-sm underline underline-offset-4">← Voltar para todos os estados</a>
      <h1 class="mt-3 text-3xl md:text-4xl font-bold tracking-tight">Melhores cidades em {STATE_NAMES[UF] ?? UF} (2026)</h1>
      <p class="mt-3 text-lg text-neutral-700">
        Ranking estadual baseado no <strong>score padrão</strong>. Para mudar a lógica, ajuste os pesos na ferramenta de pontuação.
      </p>
      <div class="mt-4 flex flex-wrap gap-2">
        <a href="/ferramentas/pontuacao-cidades/" class="rounded-xl bg-neutral-900 px-4 py-2 text-sm font-medium text-white hover:opacity-90">Ajustar pesos</a>
        <a href="/ranking-melhores-cidades-2026/" class="rounded-xl border px-4 py-2 text-sm font-medium hover:bg-neutral-50">Ranking nacional</a>
      </div>
    </div>

    <div class="mt-8 rounded-2xl border bg-white p-5 shadow-sm overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-neutral-600 border-b">
            <th class="py-2 pr-4">#</th>
            <th class="py-2 pr-4">Cidade</th>
            <th class="py-2 pr-4">Região</th>
            <th class="py-2 pr-4">Score</th>
            <th class="py-2 pr-4">População</th>
            <th class="py-2 pr-4">PIB per capita</th>
          </tr>
        </thead>
        <tbody>
          {rows.length ? rows.map((c, idx) => (
            <tr class="border-b hover:bg-neutral-50">
              <td class="py-2 pr-4">{idx + 1}</td>
              <td class="py-2 pr-4 font-medium">{c.city}</td>
              <td class="py-2 pr-4">{c.region}</td>
              <td class="py-2 pr-4">{c.score.toFixed(1)}</td>
              <td class="py-2 pr-4">{c.population?.toLocaleString("pt-BR") ?? "—"}</td>
              <td class="py-2 pr-4">{c.gdpPerCapitaBRL ? `R$ ${c.gdpPerCapitaBRL.toLocaleString("pt-BR")}` : "—"}</td>
            </tr>
          )) : (
            <tr><td class="py-6 text-neutral-600" colSpan={6}>Sem cidades cadastradas para este estado ainda. (É só adicionar no dataset.)</td></tr>
          )}
        </tbody>
      </table>
      <p class="mt-3 text-xs text-neutral-500">Quer que este ranking fique mais completo? Adicione mais cidades do estado em <code class="px-1 rounded bg-neutral-100">src/data/rankingData.ts</code>.</p>
    </div>
  </section>
</BaseLayout>
