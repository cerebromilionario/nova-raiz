---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { CITY_METRICS_2026, DEFAULT_WEIGHTS, scoreCity, STATE_NAMES } from "../../../data/rankingData";

const title = "Melhores cidades por estado (2026) — Nova Raiz";
const description = "Cluster estadual: ranking por UF com base em pontuação configurável. Use como mapa rápido e navegue para detalhes.";

const states = Array.from(new Set(CITY_METRICS_2026.map((c) => c.state))).sort();
const topByState = states.map((uf) => {
  const list = CITY_METRICS_2026.filter((c) => c.state === uf)
    .map((m) => ({ ...m, score: scoreCity(m, DEFAULT_WEIGHTS).score }))
    .sort((a, b) => b.score - a.score);
  return { uf, name: STATE_NAMES[uf] ?? uf, top: list.slice(0, 5) };
});
---

<BaseLayout title={title} description={description}>
  <section class="container mx-auto px-4 py-10">
    <div class="max-w-3xl">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Melhores cidades por estado (2026)</h1>
      <p class="mt-3 text-lg text-neutral-700">
        Um <strong>cluster estadual</strong> para você navegar rapidamente por UF.
        Dentro de cada estado, mostramos o top 5 pelo score padrão (ajustável na ferramenta de pontuação).
      </p>
      <div class="mt-4 flex flex-wrap gap-2">
        <a href="/ferramentas/pontuacao-cidades/" class="rounded-xl bg-neutral-900 px-4 py-2 text-sm font-medium text-white hover:opacity-90">Ajustar pesos (pontuação)</a>
        <a href="/ranking-melhores-cidades-2026/" class="rounded-xl border px-4 py-2 text-sm font-medium hover:bg-neutral-50">Ranking nacional</a>
      </div>
    </div>

    <div class="mt-10 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
      {topByState.map((s) => (
        <article class="rounded-2xl border bg-white p-5 shadow-sm">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h2 class="text-lg font-semibold">{s.name} <span class="text-neutral-500">({s.uf})</span></h2>
              <p class="text-sm text-neutral-600">Top 5 cidades (score padrão)</p>
            </div>
            <a href={`/ranking/estado/${s.uf.toLowerCase()}/`} class="text-sm font-medium underline underline-offset-4">ver ranking</a>
          </div>

          <ul class="mt-4 space-y-2">
            {s.top.map((c, i) => (
              <li class="flex items-center justify-between text-sm">
                <span class="font-medium">{i + 1}. {c.city}</span>
                <span class="text-neutral-600">{c.score.toFixed(1)}</span>
              </li>
            ))}
          </ul>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
